<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerta JW</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body { font-family: Arial; background: #f4f4f4; padding: 20px; display: flex; justify-content: center; }
        .box { width: 100%; max-width: 650px; background: white; border: 4px solid #ffcc00; border-radius: 15px; padding: 25px; }
        .header { display: flex; align-items: center; margin-bottom: 25px; position: relative; }
        .logo { font-size: 45px; font-weight: bold; color: #002f6c; margin-right: auto; }
        .logo span { color: #ffcc00; }
        .title { color: #ffcc00; text-decoration: underline; font-weight: bold; font-size: 22px; text-transform: uppercase; position: absolute; left: 50%; transform: translateX(-50%); width: 100%; text-align: center; pointer-events: none; }
        .row { display: flex; gap: 15px; margin-bottom: 15px; }
        .group { flex: 1; display: flex; flex-direction: column; }
        label { font-weight: bold; font-size: 13px; margin-bottom: 5px; }
        input, textarea { padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; width: 100%; box-sizing: border-box; }
        .btn { width: 100%; padding: 18px; background: #ea4335; color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; text-transform: uppercase; cursor: pointer; margin-top: 20px; }
        .btn:disabled { background: #ccc; }
    </style>
</head>
<body>
<div class="box">
    <div class="header">
        <div class="logo">N<span>.</span></div>
        <div class="title">Alerta de Qualidade</div>
    </div>
    <form id="formJW">
        <div class="row">
            <div class="group"><label>DATA</label><input type="date" id="data" required></div>
            <div class="group"><label>ITEM</label><input type="text" id="item" required></div>
        </div>
        <div class="group"><label>OCORRÊNCIA</label><textarea id="ocorrencia" rows="4" required></textarea></div>
        <div class="group" style="margin-top:10px;"><label>FOTOS</label><input type="file" id="fotos" accept="image/*" multiple></div>
        <button type="button" class="btn" id="btn" onclick="enviar()">Enviar Alerta</button>
    </form>
</div>

<script>
    (function(){ emailjs.init("aPEKFF6QbRnclt5n4"); })();

    async function enviar() {
        const btn = document.getElementById('btn');
        if(!document.getElementById('formJW').checkValidity()) { alert("Preencha tudo!"); return; }
        btn.disabled = true; btn.innerText = "⏳ ENVIANDO...";

        let linksHtml = "";
        const files = document.getElementById('fotos').files;
        for (let f of files) {
            const fd = new FormData();
            fd.append("file", f);
            fd.append("upload_preset", "Falta de Peça - Registro de Ocorrências");
            try {
                const res = await fetch("https://api.cloudinary.com/v1_1/DHPVTXJJW/image/upload", { method: "POST", body: fd });
                const d = await res.json();
                if(d.secure_url) linksHtml += `<div style="margin:5px 0;"><a href="${d.secure_url}" target="_blank" style="color: #002f6c; font-weight: bold;">Ver Foto Anexada</a></div>`;
            } catch (e) { console.error(e); }
        }

        const params = {
            data: document.getElementById('data').value.split('-').reverse().join('/'),
            item: document.getElementById('item').value,
            ocorrencia: document.getElementById('ocorrencia').value,
            links_fotos: linksHtml || "Nenhuma foto anexada."
        };

        emailjs.send('service_f8m5n8r', 'template_xi1y9ga', params)
            .then(() => { alert("✅ Enviado!"); location.reload(); })
            .catch(() => { alert("Erro!"); btn.disabled = false; btn.innerText = "Enviar Alerta"; });
    }
</script>
</body>
</html>